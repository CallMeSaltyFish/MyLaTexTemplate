%-*- coding=utf-8 -*-
\documentclass[UTF8]{ctexart}
\usepackage{geometry}
\usepackage{cite}
\CTEXsetup[format={\Huge\bfseries}]{section}
\CTEXsetup[format={\LARGE\bfseries}]{subsection}
%\usepackage{titlesec}
\geometry{left=3.18cm,right=3.18cm,top=2.54cm,bottom=2.54cm}
\usepackage{graphicx}
\pagestyle{plain}	
% \usepackage{booktabs}
% \usepackage{subfigure}
\usepackage{setspace}
\begin{document}
\nocite{*}%show all references
\bibliographystyle{plain}
	\begin{center}
		\quad \\
		\quad \\
		\vskip 3.5cm
		\heiti \fontsize{45}{17} 实习报告
		\vskip 3.5cm
		%\heiti \fontsize{39}{17} 课程设计
	\end{center}
	\vskip 3.5cm
	\begin{quotation}
		\heiti \fontsize{36}{17}
		\doublespacing
		\par\setlength\parindent{12em}
		\quad 
		\heiti		
		
		姓\hspace{0.61cm} 名：\underline{王梓岩}
		
		学\hspace{0.61cm} 号：\underline{71Y16118}

		学\hspace{0.61cm} 院：\underline{软件学院}
		
		实习单位：\underline{National Instruments}
		
		\vskip 2cm
		\centering
	\end{quotation}
	
\newpage
\songti \fontsize{13}{13}
\large
\section{实习的性质与意义}
本科生参与实习，可以透过理论联系实际，巩固所学的知识，提高处理实际问题的潜力，为顺利毕业进行做好充分的准备，并为自身能顺利与社会环境接轨做
准备。透过实习，进一步理解和领会所学的基本理论，了解计算机技术和信息管理技术的发展及应用，较为系统地掌握计算机应用技能和信息管理技能，把所
学知识与解决实际问题相联系，能够利用计算机处理工作中的各种信息，培养发现问题、分析问题和解决问题的潜力，从而提高从事实际工作的潜力。
\par
生产实习是一个极为重要的实践性教学环节。透过实习，使学生在社会实践中接触与本专业相关的实际工作，增强感性认识，培养和锻炼学生综合运用所学的
基础理论、基本技能和专业知识，去独立分析和解决实际问题的潜力，把理论和实践结合起来，提高实践动手潜力，为学生毕业后走上工作岗位打下必须的基
础；同时能够检验教学效果，为进一步提高教育教学质量，培养合格人才积累经验。计算机是一门对实践要求较高的学科，透过专业实习，使学生能熟悉有关
计算机专业的各个领域，使学生毕业后能胜任与本专业相关的工作。
\par
大学本科期间，主要学习的是理论基础知识，辅以实践环节，由于缺乏对当今社会市场的了解，从而无法有效地将所学知识运用到实际的生产生活中去。此时，
毕业实习的好处就凸显出来，通过亲身参与毕业实习，学生有机会接触第一线的计算机行业的工作内容及流程，有条件进行进一步的深造，从而给高校学生一
个了解社会，增加经验，熟悉工作单位的机会。锻炼自身的动手潜力，将学习的理论知识运用于实践当中，反过来还能检验书本上理论的正确性，有利于融会
贯通。同时，也能开拓视野，完善自身的知识结构，到达锻炼潜力的目的。一切都是为了让实践者对本专业知识构成一个客观，理性的认识，从而不与社会现
实相脱节。此外透过理论联系实际，巩固所学的知识，提高处理实际问题的潜力，了解设计专题的主要资料，为毕业设计的顺利进行做好充分的准备，并为自
己能顺利与社会环境接轨做准备。

\section{企业背景及企业文化}
\subsection{实习单位简介}
本人实习单位为美国国家仪器公司中国上海分公司。国家仪器股份有限公司（National Instruments，简称NI或恩艾仪器）是一家美国公司，从事与测试、控
制、设计领域相关的，包括虚拟仪器和电子测试设备等工程软件的开发。著名产品有图形开发环境LabVIEW、C语言虚拟仪器应用系统LabWindows/CVI、集成电
路分析程序NI Multisim等等；硬件产品包括VXI总线、PXI总线、VME总线的框架与模块，IEEE-488接口以及内部整合电路和其他自动化技术的标准。作为一家
自2000年连续11年入选财富杂志百大最佳工作环境名单的公司，国家仪器在全球范围内拥有五千余名员工并在41个国家经营。NI拥有庞大的用户群体——仅在
2004年度，全球就有超过25，000家公司从NI购买了产品。用户的智慧结合NI先进、优质的产品，造就了无数成功的测试测量方案。借助商业化的计算机平台，
用户仅以传统测试测量系统一半乃至十分之一的成本，便可获得与之相同或更出色的功能。现在，NI中国分公司委托国家级计量单位上海计量院为有需求的用
户提供有偿的专业校验与校准服务，颁发校验证书，确保产品的长期测量精度。
\subsection{工作岗位简介}
本人的岗位为Research \& Development(研究与开发)部的实习开发工程师，负责部门蓝牙、FPGA、Azure Pipeline等项目的开发与日常维护，以下会详细说明
实习经历及项目。R\&D部门最重要的工作是为其他硬件设施提供软件支持或驱动，也负责研究一些新兴技术如低功耗蓝牙、ATS自动化测试等。R\&D部门在很大
程度上受物联网和无线标准爆炸的推动，无线已成为连接设备不可或缺的一部分。NI创建了快速且经济高效的无线测试解决方案，设计出了创新和高质量的产
品。NI解决方案简化了并行测试，缩短了测试时间，并降低了测试成本。NI测试解决方案从一致性到大批量生产，从5G到802.11ax，再到近场通信（NFC）和无
线充电。NI矢量信号收发器（VST）设计用于对各种无线设备进行快速而准确的测试，包括WLAN接入点，蜂窝手机和信息娱乐系统。R\&D部门日常使用的开发语
言有c、python、yml、LabVIEW、powershell等，使用git进行版本控制，perforce进行云端数据的存储。

\section{实习环节中遇到的问题及困难}
\subsection{入门阶段}
按照公司文档，将工作的电脑配置 python 2.7，python 3.6，LabVIEW，C\#，和GIT的运行环境，并且按照文档的介绍熟悉了GIT的 add，push，pull，
commit，remove等操作。特别地，由于今后的开发中会同时用到 python 的 2.x 和 3.x 版本，且python 2和python 3互不兼容，按照参考文档，使用 
anaconda管理python环境，同时建立两个虚拟环境，分别为2.x 版本和3.x版本，这样以后可以在终端中输入“activate 环境名”来达到使用不同版本 python
的目的。
\par
按照公司的规定，开发文档也应由git管理，而常用的MS Word文档均为二进制文件，故不适合用git管理，因此，公司文档均由markdown书写。熟悉了md的基本
语法、会编写一个完整的markdown文档，markdown的插入公式的格式完全来源于LaTex，因此学习起来不算困难。熟悉了云端存储办公软件perforce的基本用法
及命令行操作。
\par
熟悉命令行操作在实际的开发中可以大大提高开发效率，在Windows操作系统上，powershell的实用性非常大，熟悉并掌握powershell的常用操作十分必要，且
git的若干操作通过命令行执行效率更高。在powershell中，所有cmd指令都是可用的，比如dir，cd，tree，echo等。powershell也吸收了unix平台的一些操作
，比如ls，rm等。powershell最重要的就是指令（cmdlet），可以视为函数或者方法。首先cmd的指令和部分类unix指令可以使用，比如：echo（打印），cd
（进入目录），dir/ls（打印目录内容），cp（复制文件），mv（移动文件），mkdir（创建目录）等。powershell 内置许多非常强大的指令，比如 Get-Item
（获取文件对象）， Test-Path（检查路径是否存在）， Get-Date（获取当前时间）等，具体可查阅微软官方手册。powershell 一个非常重要的功能就是管
道运算符（|），即在一组命令中，输出的命令结果成为下一个命令的输入参数。管道的概念与真实生活中的生产线比较相似：在不同的生产环节进行连续的再
加工，我们可以发现管道运算符的写法逻辑非常清晰，易于理解。
\par
入门阶段主要是熟悉各种开发语言、开发工具的操作和用途，相当于是起步阶段，虽然有的工具还不是非常熟悉，但在今后的开发中可以继续积累经验，达到熟
能生巧的地步。版本控制这一思想在本科阶段的课程中体现的不是很重要，但在实际开发的过程中却是非常重要的，今后的开发，即便是个人的敏捷开发，也尽
量使用版本管理工具来进行控制，对于形成软件工程的思想，是大有裨益的。

\subsection{FPGA编译器语义分析}
\subsubsection{总览}
FPGA编译器语义分析流程大致分为以下几个部分：
\par
1. 从源模型构建初始DFIR。
\par
2. 根据编译上下文确定用户未设置或动态设置的语义属性(例如，可编译源模型通常不指定所有数据类型和隧道方向)。
\par
3. 检测非法的源构造，例如未接线的端子，不兼容的类型，不良的循环等。
\par
4. 将由编译器确定的属性和/或消息反映到源模型。
\par
5. 产生准备用于后续编译阶段使用的DFIR。触发SA以响应各种编译器和源模型事件。例如，源模型更改会更改模型的任何语义含义，或者更改依赖项在语义上
影响依赖者的任何依赖项。
\subsubsection{更改可编译源模型}
1. 加载模型：加载模型时，CompilerService会附加到模型上，然后从SA开始。这仅仅是为了确保正确设置此源模型中的所有语义属性。许多计算出的语义属性
只是没有保存在源模型中，因此需要在每次加载时进行设置。
\par
2. 编辑模型：具有语义效果的任何编辑都将要求进行编译。CompilerService正在监听ITransactionManager.TransactionStateChanged事件。如果事务中有任
何事务项导致源文件在语义上被认为是脏的，SA将启动。与MocPlugin关联的对象将根据相应的计算模型来确定哪些交易是语义更改。如果用户
操作(例如撤消、重做)引起了语义上的变化，也将对其进行检查，并根据检查结果触发SA。
\par
3. 在编辑器中打开模型：在编辑器中打开文档或创建新文档时，UI线程将附加到Envoy，这将增加的用户优先级 Envoy。编译器服务会关注Envoy通孔的用户优先
级变化，IUserPriorityEnvoyService并且在从未对源模型副本进行语义分析时会触发(高优先级)SA。
\subsubsection{更改不可编译源模型}
1. WaitForSemanticAnalysisAsync：CompilerService公开的API，用于请求和等待SA结果，如果没有运行SA或正在为请求的SA运行BuildSpec，那么将启动一个
新的WaitForSemanticAnalysisAsync。
\par
2. GetTargetDfirAsync：IAnyMocCompiler公开的API以获取目标级别的DFIR，它将触发一次SA，以确保在有效的SA之后生成目标级别的DFIR。
\par
3. TargetCompiler.CompileAsync：TargetCompiler运行后端编译的API将调用GetTargetDfirAsync以获取目标级别的DFIR进行编译，它也可以调度SA。
\subsubsection{SA的执行流程}
创建一个SemanticAnalysisActivity对象，SemanticAnalysisActivity为每个SA申请内存并在后台线程上运行。一旦开始运行，活动将查询MocPlugin来生成源
DFIR，它将可编译的源模型转换为源DFIR。
\par
\subsubsection{Moc插件}
Moc插件定义了一个语义分析所依赖的算法或数学模型，一个完整的Moc插件需要定义以下几个部分：
\par
1. MocReflector：MocReflector附加到它生成的源DFIR。MocReflector可以容纳特定于计算模型的反射变换。
\par
2. MocTransformManager：MocTransformManager提供了DFIR转换的时间表，构成了语义分析完成的其余工作。这些变换可以包括SemanticAnalysisTransform
针对计算模型的通用变换以及其他特定于模型的变换。
\par
3. SemanticAnalysisTransform：此转换执行标准的数据流语义分析，即在DFIR 图上的完整类型传播。
\par
4. InternalTypePropagationVisitor：可以将其配置为访问DFIR上的所有或部分节点子集。转换期间将调用任何插件节点以进行其类型传播。
\par
5. ReflectionTransform：此转换负责将任何编译结果反映到源模型。如果每个Moc插件在其DFIR图中具有任何非标准的语义信息或插件DFIR点，则都需要考虑
使用自己的类型/语义信息反射转换。该模块由Pipeline自动生成，不应手动修改其代码。
\par

\subsection{自动化测试系统}
NI的自动化测试系统（Automated Testing System，简称ATS）是为了对FPGA、驱动器等产品进行自动化测试的平台，ATS建立在Azure Pipeline的架构上。对
测试平台的主要工作为修改 ATS 系统以跳过 FPGA 的编译。
\subsubsection{ATS原有设计方案}
(对于每一个测试用例)加载 YAML 配置文件，YAML(YML)是一种类似于 XML或 JSON 的结构化语言，也是靠映射形成的一个多级目录，一个主键可以引导一个值
或一个字典，可视为一个分级的散列。此时所有测试用例进入初始化(initialized)状态。
\par
进行预处理(manipulate)操作，状态置为预处理(manipulated)状态。
\par
进行编译(compile)操作。当测试用例还在编译的时候，状态为正在编译 (compiling)，一旦结束状态就变为已编译(compiled)。
\par
部署(deploy)并运行(run)测试用例，状态置为部署并运行(deploy \& run)。
\par
输出测试结果，结束。
\subsubsection{ATS改进方案}
通过白盒检查代码易于发现，在编译的过程中，每有一个测试用例，就专门申请一个线程，负责该测试用例的编译工作。一旦编译完成，该线程就将状态更新
为“已编译”。与此同时，主线程不停地轮询所有测试用例的状态，当所有测试用例的状态均为已编译时，即可进行接下来的步骤。
\par
基于以上信息，对 ATS 作出的改进为:对于每一个测试用例，在“申请线程”操作之前，先检查一个布尔值，这里命名为 skip\_compile。如果布尔值为真，直接
将该测试用例的状态改为“已编译”，之后直接轮到下一个测试用例;否则，按原有的代码逻辑进行操作。这样一来，对于一个不需要编译的测试用例来说，不会
执行申请线程、开始编译等所有的编译相关操作，直接被视为已编译。将该测试用例的状态改为“已编译”这一操作十分重要，不仅可以被主线程视为已经编译，
同时在下一个阶段执行之前，所有的测试用例的状态会被检查一遍，如果状态是“已编译”之前的状态，代码会抛出异常，这样做可使代码正常运行。
\par
最后一个待解决的问题就是布尔值 skip\_compile 如何得到。前面已经指出，ATS 的第一步就是读取配置文件，这就要求测试人员在每次测试之前显式地添加
表达式“skip\_compile:True”，才能使ATS系统正常运行。

\subsection{Azure Pipeline}

\bibliography{report}
\end{document}